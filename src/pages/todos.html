<script type="ellx">
  import { localState, todos, addTodo, editTodo, removeTodo, startEditing } from '../scripts/todos.js';

  [editing, setEditing] = localState(null);

</script>

<div data-for="[id, { text, done }] of todos">
  <div class="row highlight">
    <div class="col">
      <input type="checkbox" data-bind="
        checked = done
        @input = e => editTodo(id, { done: e.target.checked })
      ">
      <input data-if="editing === id" placeholder = "What's next?" data-bind="
        value = text
        @mount = el => startEditing(el, () => setEditing(null))
        @input = e => editTodo(id, { text: e.target.value })
      " class="blend-in">
      <span data-else data-is="text" data-bind="
        .line-through = done
        @click = () => setEditing(id)
        @keydown = () => setEditing(id)
      " tabindex="0"></span>
    </div>
    <div class="1 col">
      <a href="" class="show-on-hover" data-bind="@click = () => removeTodo(id)">🗑️</a>
    </div>
</div>
</div>
<div class="row">
  <div class="col">
    <input data-if="editing === undefined" placeholder = "What's next?" data-bind="
      @mount = el => startEditing(el, text => (text && addTodo(text), setEditing(null)))
    " class="blend-in">
    <a href="" data-else data-bind="@click = () => setEditing(undefined)">📝 Add todo</span>
  </div>
</div>
